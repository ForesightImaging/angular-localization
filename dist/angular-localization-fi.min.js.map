{"version":3,"sources":["angular-localization-fi.js"],"names":["angular","window","document","undefined","module","constant","value","en","service","$injector","$http","$q","$log","$rootScope","$window","localeConf","localeEvents","localeSupported","localeFallbacks","isLocalStorageAvail","test","localStorage","setItem","removeItem","e","splitToken","tok","key","path","allowNestedJson","split","length","slice","sym","push","join","isToken","str","TOKEN_REGEX","getPath","result","getKey","getBundle","i","bundles","isFrozen","obj","Object","$$frozen","freeze","replaceAll","substr","sub","replace","RegExp","loadBundle","token","parent","ref","root","locale","currentLocale","url","basePath","extend","_loading","fileExtension","get","then","response","data","hasOwnProperty","$broadcast","resourceUpdates","bundle","deferrences","resolve","err","error","reject","bundleReady","langFile","defer","promise","ready","paths","deferred","outstanding","isString","isArray","Error","forEach","all","applySubstitutions","text","subs","res","firstOfKind","v","k","getLocalizedString","txt","A","isValidToken","indexOf","delimiter","fromJson","isObject","info","updateHtmlTagLangAttr","lang","$html","attr","getLanguageSupported","language","foundLanguage","languageSuppported","fallbackLang","isUndefined","defaultLocale","setLocale","trim","localeChanges","cookies","put","cookieName","persistSelection","getLocale","getPreferredBrowserLanguage","nav","navigator","browserLanguagePropertyKeys","languages","initialSetLocale","initial","cookie","local","getItem","validTokens","element","body","has","getString","filter","i18nFilter","input","args","$stateful","directive","$sce","setText","elm","tag","html","getTrustedHtml","update","string","optArgs","scope","attrs","hasObservers","$observe","newVal","oldVal","$attr","normAttr","observableAttrs","i18n","$on","setAttr","$attrs","$set","$normalize","getUpdateText","$scope","target","lastValues","attributes","exp","values","$eval","langFiles","priority","compile","$elem","i18nAttr","updateText","sharedDictionary"],"mappings":"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","file":"angular-localization-fi.min.js","sourcesContent":["/*!\n * angular-localization-fi :: v1.6.1 :: 2018-10-04\n * web: http://doshprompt.github.io/angular-localization\n *\n * Copyright (c) 2018 | Rahul Doshi\n * License: MIT\n */\n;(function (angular, window, document, undefined) {\r\n    'use strict';\r\n\nangular.module('ngLocalize.Version', [])\r\n    .constant('localeVer', '1.6.1');\nangular.module('ngLocalize', ['ngSanitize', 'ngLocalize.Config', 'ngLocalize.Events', 'ngLocalize.InstalledLanguages']);\r\n\nangular.module('ngLocalize.InstalledLanguages', [])\r\n    .value('localeSupported', [\r\n        'en-US'\r\n    ])\r\n    .value('localeFallbacks', {\r\n        'en': 'en-US'\r\n    });\nangular.module('ngLocalize')\r\n    .service('locale', function ($injector, $http, $q, $log, $rootScope, $window, localeConf, localeEvents, localeSupported, localeFallbacks) {\r\n        var TOKEN_REGEX = localeConf.validTokens || new RegExp('^([\\\\w-]+\\\\/)*([\\\\w-]+\\\\.)+([\\\\w\\\\s-])+\\\\w(:.*)?$'),\r\n            $html = angular.element(document.body).parent(),\r\n            currentLocale,\r\n            deferrences,\r\n            bundles,\r\n            cookies,\r\n            sym = localeConf.allowNestedJson ? '/' : '.';\r\n\r\n        if (localeConf.persistSelection && $injector.has('$cookies')) {\r\n            cookies = $injector.get('$cookies');\r\n        }\r\n        function isLocalStorageAvail(){\r\n            var test = 'test';\r\n            try {\r\n                localStorage.setItem(test, test);\r\n                localStorage.removeItem(test);\r\n                return true;\r\n            } catch(e) {\r\n                return false;\r\n            }\r\n        }\r\n        function splitToken(tok){\r\n            var key, path;\r\n            if (localeConf.allowNestedJson){\r\n                var split = tok ? tok.split('.') : [];\r\n                key = split.length > 1 ? split.slice(1) : '';\r\n                path = split.length > 0 ? split[0].split(sym) : [];\r\n                path.push(split.length > 1 ? split[1] : '');\r\n            } else {\r\n                path = tok ? tok.split('/').join('.').split('.') : [];\r\n                key = path.length > 1 ? path[path.length - 1] : '';\r\n            }\r\n            return {\r\n                key: key,\r\n                path: path\r\n            };\r\n        }\r\n\r\n        function isToken(str) {\r\n            return (str && str.length && TOKEN_REGEX.test(str));\r\n        }\r\n\r\n        function getPath(tok) {\r\n            var path = splitToken(tok).path,\r\n                result = '';\r\n\r\n            if (path.length > 1) {\r\n                result = path.slice(0, -1).join(sym);\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function getKey(tok) {\r\n            return splitToken(tok).key;\r\n        }\r\n\r\n        function getBundle(tok) {\r\n            var result = null,\r\n                path = splitToken(tok).path,\r\n                i;\r\n\r\n            if (path.length > 1) {\r\n                result = bundles;\r\n\r\n                for (i = 0; i < path.length - 1; i++) {\r\n                    if (result[path[i]]) {\r\n                        result = result[path[i]];\r\n                    } else {\r\n                        result = null;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function isFrozen (obj) {\r\n            return (Object.isFrozen || function (obj) {\r\n                return obj && obj.$$frozen;\r\n            })(obj);\r\n        }\r\n\r\n        function freeze (obj) {\r\n            return (Object.freeze || function (obj) {\r\n                if (obj) {\r\n                    obj.$$frozen = true;\r\n                }\r\n            })(obj);\r\n        }\r\n\r\n        // http://stackoverflow.com/a/17606289\r\n        function replaceAll(str, substr, sub) {\r\n            return str.replace(new RegExp(substr.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'g'), sub);\r\n        }\r\n\r\n        function loadBundle(token) {\r\n            var path = splitToken(token).path,\r\n                root = bundles,\r\n                parent,\r\n                locale = currentLocale,\r\n                url = localeConf.basePath + '/' + locale,\r\n                ref,\r\n                i;\r\n\r\n            if (path.length > 1) {\r\n                for (i = 0; i < path.length - 1; i++) {\r\n                    ref = path[i];\r\n                    if (!root[ref]) {\r\n                        root[ref] = {};\r\n                    }\r\n                    parent = root;\r\n                    root = root[ref];\r\n                    url += '/' + ref;\r\n                }\r\n\r\n                if (isFrozen(root)) {\r\n                    root = angular.extend({}, root);\r\n                }\r\n                if (!root._loading) {\r\n                    root._loading = true;\r\n\r\n                    url += localeConf.fileExtension;\r\n\r\n                    $http.get(url)\r\n                        .then(function (response) {\r\n                            var key,\r\n                                path = getPath(token),\r\n                                data = response.data;\r\n                            // Merge the contents of the obtained data into the stored bundle.\r\n                            for (key in data) {\r\n                                if (data.hasOwnProperty(key)) {\r\n                                    root[key] = data[key];\r\n                                }\r\n                            }\r\n\r\n                            // Mark the bundle as having been \"loaded\".\r\n                            delete root._loading;\r\n                            parent[ref] = freeze(root);\r\n                            root = null;\r\n\r\n                            // Notify anyone who cares to know about this event.\r\n                            $rootScope.$broadcast(localeEvents.resourceUpdates, {\r\n                                locale: locale,\r\n                                path: path,\r\n                                bundle: parent[ref]\r\n                            });\r\n\r\n                            // If we issued a Promise for this file, resolve it now.\r\n                            if (deferrences[path]) {\r\n                                deferrences[path].resolve(path);\r\n                            }\r\n                        }, function (err) {\r\n                            var path = getPath(token);\r\n\r\n                            $log.error('[localizationService] Failed to load: ' + url);\r\n\r\n                            // We can try it again later.\r\n                            delete root._loading;\r\n\r\n                            // If we issued a Promise for this file, reject it now.\r\n                            if (deferrences[path]) {\r\n                                deferrences[path].reject(err.data);\r\n                            }\r\n                        });\r\n                }\r\n            }\r\n        }\r\n\r\n        function bundleReady(path) {\r\n            var bundle,\r\n                token;\r\n\r\n            path = path || localeConf.langFile;\r\n            token = path + '._LOOKUP_';\r\n            bundle = getBundle(token);\r\n\r\n            if (!deferrences[path]) {\r\n                deferrences[path] = $q.defer();\r\n            }\r\n\r\n            if (bundle && !bundle._loading) {\r\n                deferrences[path].resolve(path);\r\n            } else {\r\n                if (!bundle) {\r\n                    loadBundle(token);\r\n                }\r\n            }\r\n\r\n            return deferrences[path].promise;\r\n        }\r\n\r\n        function ready(path) {\r\n            var paths,\r\n                deferred,\r\n                outstanding;\r\n\r\n            if (angular.isString(path)) {\r\n                paths = path.split(',');\r\n            } else if (angular.isArray(path)) {\r\n                paths = path;\r\n            } else {\r\n                throw new Error('locale.ready requires either an Array or comma-separated list.');\r\n            }\r\n\r\n            if (paths.length > 1) {\r\n                outstanding = [];\r\n                paths.forEach(function (path) {\r\n                    outstanding.push(bundleReady(path));\r\n                });\r\n                deferred = $q.all(outstanding);\r\n            } else {\r\n                deferred = bundleReady(path);\r\n            }\r\n\r\n            return deferred;\r\n        }\r\n\r\n        function applySubstitutions(text, subs) {\r\n            var res = text,\r\n                firstOfKind = 0;\r\n\r\n            if (subs) {\r\n                if (angular.isArray(subs)) {\r\n                    angular.forEach(subs, function (sub, i) {\r\n                        res = replaceAll(res, '%' + (i + 1), sub);\r\n                        res = replaceAll(res, '{' + (i + 1) + '}', sub);\r\n                    });\r\n                } else {\r\n                    angular.forEach(subs, function (v, k) {\r\n                        ++firstOfKind;\r\n\r\n                        res = replaceAll(res, '{' + k + '}', v);\r\n                        res = replaceAll(res, '%' + k, v);\r\n                        res = replaceAll(res, '%' + (firstOfKind), v);\r\n                        res = replaceAll(res, '{' + (firstOfKind) + '}', v);\r\n                    });\r\n                }\r\n            }\r\n            res = res.replace(/\\n/g, '<br>');\r\n\r\n            return res;\r\n        }\r\n\r\n        function getLocalizedString(txt, subs) {\r\n            var result = '',\r\n                bundle,\r\n                key,\r\n                A,\r\n                isValidToken = false;\r\n\r\n            if (angular.isString(txt) && !subs && txt.indexOf(localeConf.delimiter) !== -1) {\r\n                A = txt.split(localeConf.delimiter);\r\n                txt = A[0];\r\n                subs = angular.fromJson(A[1]);\r\n            }\r\n\r\n            isValidToken = isToken(txt);\r\n            if (isValidToken) {\r\n                if (!angular.isObject(subs)) {\r\n                    subs = [subs];\r\n                }\r\n\r\n                bundle = getBundle(txt);\r\n                if (bundle && !bundle._loading) {\r\n                    key = getKey(txt);\r\n                    if (localeConf.allowNestedJson){\r\n                        for (var i = 0; i < key.length - 1; i++) {\r\n                            if (bundle[key[i]]) {\r\n                                bundle = bundle[key[i]];\r\n                            } else {\r\n                                bundle = null;\r\n                                break;\r\n                            }\r\n                        }\r\n                        key =  key[key.length -1];\r\n                    }\r\n                    if (bundle[key]) {\r\n                        if (angular.isString(bundle[key])){\r\n                            result = applySubstitutions(bundle[key], subs);\r\n                        } else {\r\n                            $log.info('[localizationService] Key is not a string: ' + txt + '. Is it a nested object?');\r\n                            result = '%%KEY_NOT_STRING%%';\r\n                        }\r\n                    } else {\r\n                        $log.info('[localizationService] Key not found: ' + txt);\r\n                        result = '%%KEY_NOT_FOUND%%';\r\n                    }\r\n                } else {\r\n                    if (!bundle) {\r\n                        loadBundle(txt);\r\n                    }\r\n                }\r\n            } else {\r\n                result = txt;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function updateHtmlTagLangAttr(lang) {\r\n            lang = lang.split('-')[0];\r\n\r\n            $html.attr('lang', lang);\r\n        }\r\n\r\n        function getLanguageSupported(language) {\r\n            var foundLanguage = null;\r\n            if (language && language.length) {\r\n                localeSupported.forEach(function (languageSuppported) {\r\n                    if (languageSuppported.indexOf(language) === 0) {\r\n                        foundLanguage = languageSuppported;\r\n                        return;\r\n                    }\r\n                });\r\n                if (!foundLanguage) {\r\n                    var fallbackLang = localeFallbacks[language.split('-')[0]];\r\n                    if (!angular.isUndefined(fallbackLang)) {\r\n                      foundLanguage = fallbackLang;\r\n                    }\r\n                }\r\n            }\r\n            return foundLanguage || localeConf.defaultLocale;\r\n        }\r\n\r\n        function setLocale(value) {\r\n            var lang;\r\n\r\n            if (angular.isString(value) && value.length ) {\r\n                value = value.trim();\r\n                lang = getLanguageSupported(value);\r\n            } else {\r\n                lang = localeConf.defaultLocale;\r\n            }\r\n\r\n            if (lang !== currentLocale) {\r\n                bundles = {};\r\n                deferrences = {};\r\n                currentLocale = lang;\r\n\r\n                updateHtmlTagLangAttr(lang);\r\n\r\n                $rootScope.$broadcast(localeEvents.localeChanges, currentLocale);\r\n\r\n                if (cookies) {\r\n                    cookies.put(localeConf.cookieName, lang);\r\n                }else if(localeConf.persistSelection && isLocalStorageAvail()){\r\n                    // cookies service isnt availible and they want to persist, fallback to local storage\r\n                    localStorage.setItem(localeConf.cookieName, lang);\r\n                }\r\n            }\r\n        }\r\n\r\n        function getLocale() {\r\n            return currentLocale;\r\n        }\r\n\r\n        function getPreferredBrowserLanguage() {\r\n            var nav = $window.navigator,\r\n                browserLanguagePropertyKeys = ['language', 'browserLanguage', 'systemLanguage', 'userLanguage'],\r\n                i,\r\n                language;\r\n\r\n            // support for HTML 5.1 \"navigator.languages\"\r\n            if (angular.isArray(nav.languages)) {\r\n                for (i = 0; i < nav.languages.length; i++) {\r\n                    language = nav.languages[i];\r\n                    if (language) {\r\n                        return language;\r\n                    }\r\n                }\r\n            }\r\n            // support for other well known properties in browsers\r\n            for (i = 0; i < browserLanguagePropertyKeys.length; i++) {\r\n                language = nav[browserLanguagePropertyKeys[i]];\r\n                if (language) {\r\n                    return language;\r\n                }\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        function initialSetLocale() {\r\n            var initial = getPreferredBrowserLanguage();\r\n            var cookie = cookies && cookies.get(localeConf.cookieName);\r\n            var local = localeConf.persistSelection && isLocalStorageAvail() && localStorage.getItem(localeConf.cookieName);\r\n            setLocale(cookie || local || initial);\r\n        }\r\n\r\n        initialSetLocale();\r\n\r\n        return {\r\n            ready: ready,\r\n            isToken: isToken,\r\n            getPath: getPath,\r\n            getKey: getKey,\r\n            setLocale: setLocale,\r\n            getLocale: getLocale,\r\n            getString: getLocalizedString,\r\n            getPreferredBrowserLanguage: getPreferredBrowserLanguage\r\n        };\r\n    });\r\n\nangular.module('ngLocalize')\r\n    .filter('i18n', function (locale) {\r\n        var i18nFilter = function (input, args) {\r\n            return locale.getString(input, args);\r\n        };\r\n\r\n        i18nFilter.$stateful = true;\r\n\r\n        return i18nFilter;\r\n    });\r\n\nangular.module('ngLocalize.Events', [])\r\n    .constant('localeEvents', {\r\n        resourceUpdates: 'ngLocalizeResourcesUpdated',\r\n        localeChanges: 'ngLocalizeLocaleChanged'\r\n    });\nangular.module('ngLocalize')\r\n    .directive('i18n', function ($sce, locale, localeEvents, localeConf) {\r\n        function setText(elm, tag) {\r\n            if (tag !== elm.html()) {\r\n                elm.html($sce.getTrustedHtml(tag));\r\n            }\r\n        }\r\n\r\n        function update(elm, string, optArgs) {\r\n            if (locale.isToken(string)) {\r\n                locale.ready(locale.getPath(string)).then(function () {\r\n                    setText(elm, locale.getString(string, optArgs));\r\n                });\r\n            } else {\r\n                setText(elm, string);\r\n            }\r\n        }\r\n\r\n        return function (scope, elm, attrs) {\r\n            var hasObservers;\r\n\r\n            attrs.$observe('i18n', function (newVal, oldVal) {\r\n                if (newVal && newVal !== oldVal) {\r\n                    update(elm, newVal, hasObservers);\r\n                }\r\n            });\r\n\r\n            angular.forEach(attrs.$attr, function (attr, normAttr) {\r\n                if (localeConf.observableAttrs.test(attr)) {\r\n                    attrs.$observe(normAttr, function (newVal) {\r\n                        if (newVal || !hasObservers || !hasObservers[normAttr]) {\r\n                            hasObservers = hasObservers || {};\r\n                            hasObservers[normAttr] = attrs[normAttr];\r\n                            update(elm, attrs.i18n, hasObservers);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            scope.$on(localeEvents.resourceUpdates, function () {\r\n                update(elm, attrs.i18n, hasObservers);\r\n            });\r\n            scope.$on(localeEvents.localeChanges, function () {\r\n                update(elm, attrs.i18n, hasObservers);\r\n            });\r\n        };\r\n    })\r\n    .directive('i18nAttr', function ($rootScope, locale, localeEvents) {\r\n        function setAttr ($attrs, key, value) {\r\n            $attrs.$set($attrs.$normalize(key), value);\r\n        }\r\n\r\n        function getUpdateText ($scope, target, $attrs) {\r\n            var lastValues = {};\r\n            return function (attributes) {\r\n                var values = $scope.$eval(attributes),\r\n                    langFiles = [],\r\n                    exp;\r\n\r\n                for(var key in values) {\r\n                    exp = values[key];\r\n                    if (locale.isToken(exp) && langFiles.indexOf(locale.getPath(exp)) === -1) {\r\n                        langFiles.push(locale.getPath(exp));\r\n                    }\r\n                }\r\n\r\n                locale.ready(langFiles).then(function () {\r\n                    var value = '';\r\n                    for(var key in values) {\r\n                        exp = values[key];\r\n                        value = locale.getString(exp);\r\n                        if (lastValues[key] !== value) {\r\n                            lastValues[key] = value;\r\n                            setAttr($attrs, key, value);\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n        }\r\n\r\n        return {\r\n            // ensure has higher priority than ngAria\r\n            priority: 1000,\r\n            compile: function ($elem, $attrs) {\r\n                angular.forEach($rootScope.$eval($attrs.i18nAttr), function (value, key) {\r\n                    // temporarily populate attribute\r\n                    // avoid false positive warning about aria-label\r\n                    setAttr($attrs, key, value || '...');\r\n                });\r\n\r\n                return function ($scope, $elem, $attrs) {\r\n                    var updateText = getUpdateText($scope, $elem, $attrs);\r\n\r\n                    $attrs.$observe('i18nAttr', function (newVal) {\r\n                        if (newVal) {\r\n                            updateText(newVal);\r\n                        }\r\n                    });\r\n\r\n                    $scope.$on(localeEvents.resourceUpdates, function () {\r\n                        updateText($attrs.i18nAttr);\r\n                    });\r\n\r\n                    $scope.$on(localeEvents.localeChanges, function () {\r\n                        updateText($attrs.i18nAttr);\r\n                    });\r\n                };\r\n            }\r\n        };\r\n    });\r\n\nangular.module('ngLocalize.Config', [])\r\n    .value('localeConf', {\r\n        basePath: 'languages',\r\n        defaultLocale: 'en-US',\r\n        sharedDictionary: 'common',\r\n        fileExtension: '.lang.json',\r\n        persistSelection: true,\r\n        cookieName: 'COOKIE_LOCALE_LANG',\r\n        observableAttrs: new RegExp('^data-(?!ng-|i18n)'),\r\n        delimiter: '::',\r\n        validTokens: new RegExp('^([\\\\w-]+\\\\/)*([\\\\w-]+\\\\.)+([\\\\w\\\\s-])+\\\\w(:.*)?$'),\r\n        allowNestedJson: false\r\n    });\r\n\n}(window.angular, window, window.document));\r\n"]}